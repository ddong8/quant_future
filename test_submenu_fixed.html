<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>子菜单功能测试 - 修复版</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 32px;
        }
        .title {
            margin: 0 0 12px 0;
            font-size: 32px;
            font-weight: 700;
            color: #2c3e50;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .subtitle {
            margin: 0;
            font-size: 18px;
            color: #7f8c8d;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border-left: 4px solid #667eea;
        }
        .test-section h3 {
            margin: 0 0 16px 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .menu-structure {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #dee2e6;
        }
        .menu-item {
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 6px;
            background: #f8f9fa;
            border-left: 3px solid #667eea;
        }
        .menu-item.parent {
            background: #e3f2fd;
            border-left-color: #2196f3;
            font-weight: 600;
        }
        .menu-item.child {
            margin-left: 24px;
            background: #f3e5f5;
            border-left-color: #9c27b0;
            font-size: 14px;
        }
        .test-steps {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #dee2e6;
        }
        .test-steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .test-steps li {
            margin: 8px 0;
            line-height: 1.6;
        }
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 24px 0;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .btn.secondary {
            background: #6c757d;
        }
        .btn.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        .status-indicator.fixed {
            background: #d4edda;
            color: #155724;
        }
        .status-indicator.testing {
            background: #fff3cd;
            color: #856404;
        }
        .expected-results {
            background: #e8f5e8;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #c3e6c3;
        }
        .expected-results h4 {
            margin: 0 0 12px 0;
            color: #2d5a2d;
        }
        .expected-results ul {
            margin: 0;
            padding-left: 20px;
        }
        .expected-results li {
            margin: 6px 0;
            color: #2d5a2d;
        }
        .debug-info {
            background: #fff3cd;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #ffeaa7;
            margin-top: 24px;
        }
        .debug-info h4 {
            margin: 0 0 12px 0;
            color: #856404;
        }
        .debug-info pre {
            background: white;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">🔧 子菜单功能测试</h1>
            <p class="subtitle">验证左侧导航栏子菜单是否正常显示和工作</p>
            <span class="status-indicator fixed">✅ 已修复</span>
        </div>

        <div class="test-section">
            <h3>📋 预期的菜单结构</h3>
            <div class="menu-structure">
                <div class="menu-item parent">🏠 仪表板</div>
                
                <div class="menu-item parent">📈 交易中心</div>
                <div class="menu-item child">• 交易面板</div>
                <div class="menu-item child">• 手动交易</div>
                <div class="menu-item child">• 快速交易</div>
                
                <div class="menu-item parent">📋 订单管理</div>
                <div class="menu-item child">• 订单列表</div>
                <div class="menu-item child">• 历史订单</div>
                <div class="menu-item child">• 订单模板</div>
                
                <div class="menu-item parent">📊 持仓管理</div>
                <div class="menu-item child">• 当前持仓</div>
                <div class="menu-item child">• 持仓历史</div>
                <div class="menu-item child">• 持仓分析</div>
                
                <div class="menu-item parent">🎯 策略管理</div>
                <div class="menu-item child">• 策略列表</div>
                <div class="menu-item child">• 创建策略</div>
                <div class="menu-item child">• 策略模板</div>
                <div class="menu-item child">• 策略绩效</div>
                
                <div class="menu-item parent">⚙️ 系统设置</div>
                <div class="menu-item child">• 通用设置</div>
                <div class="menu-item child">• 账户设置</div>
                <div class="menu-item child">• 交易设置</div>
                <div class="menu-item child">• 通知设置</div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn" onclick="openTradingPlatform()">
                🌐 打开交易平台
            </button>
            <button class="btn secondary" onclick="showTestSteps()">
                📝 查看测试步骤
            </button>
            <button class="btn success" onclick="runAutoTest()">
                🧪 自动测试
            </button>
        </div>

        <div class="test-section" id="test-steps" style="display: none;">
            <h3>🧪 测试步骤</h3>
            <div class="test-steps">
                <ol>
                    <li><strong>打开平台：</strong>点击"打开交易平台"按钮，在新窗口中访问 http://localhost:3000</li>
                    <li><strong>登录系统：</strong>使用账号 <code>admin</code> 密码 <code>admin123</code> 登录</li>
                    <li><strong>检查菜单：</strong>查看左侧导航栏是否显示了所有主菜单项</li>
                    <li><strong>点击主菜单：</strong>依次点击"交易中心"、"订单管理"等主菜单项</li>
                    <li><strong>验证子菜单：</strong>确认点击后能看到对应的子菜单项展开</li>
                    <li><strong>测试子菜单：</strong>点击子菜单项，验证能否正确跳转到对应页面</li>
                    <li><strong>检查高亮：</strong>确认当前页面的菜单项有高亮显示</li>
                    <li><strong>测试收起：</strong>再次点击主菜单项，验证子菜单能否收起</li>
                </ol>
            </div>
        </div>

        <div class="expected-results">
            <h4>🎯 预期测试结果</h4>
            <ul>
                <li>✅ 左侧导航栏显示所有主菜单项</li>
                <li>✅ 点击主菜单项时子菜单能够展开</li>
                <li>✅ 子菜单项能够正确显示</li>
                <li>✅ 点击子菜单项能跳转到对应页面</li>
                <li>✅ 当前激活的菜单项有高亮显示</li>
                <li>✅ 再次点击主菜单能收起子菜单</li>
                <li>✅ 面包屑导航显示正确路径</li>
                <li>✅ 访问子页面时自动展开对应主菜单</li>
            </ul>
        </div>

        <div class="debug-info">
            <h4>🔍 修复详情</h4>
            <p><strong>问题原因：</strong>MainLayout 组件的菜单构建逻辑没有正确处理路由中的 parent 属性，导致子菜单无法正确分组和显示。</p>
            <p><strong>修复方案：</strong></p>
            <pre>// 重新构建菜单结构逻辑
const menuRoutes = computed(() => {
  const menuMap = new Map()
  
  // 定义主菜单项
  const mainMenus = [
    { key: 'dashboard', title: '仪表板', icon: 'Dashboard', path: '/' },
    { key: 'trading', title: '交易中心', icon: 'Monitor', path: '/trading' },
    { key: 'orders', title: '订单管理', icon: 'Document', path: '/orders' },
    { key: 'positions', title: '持仓管理', icon: 'Wallet', path: '/positions' },
    { key: 'strategies', title: '策略管理', icon: 'List', path: '/strategies' },
    { key: 'settings', title: '系统设置', icon: 'Setting', path: '/settings' }
  ]
  
  // 根据路由的 parent 属性构建子菜单
  allRoutes.forEach(route => {
    const parent = route.meta?.parent
    if (parent && menuMap.has(parent)) {
      const parentMenu = menuMap.get(parent)
      parentMenu.children.push({
        path: route.path,
        meta: route.meta
      })
    }
  })
  
  return Array.from(menuMap.values())
})</pre>
        </div>

        <div id="test-result" style="margin-top: 24px;"></div>
    </div>

    <script>
        let testWindow = null;

        function openTradingPlatform() {
            testWindow = window.open('http://localhost:3000', 'trading_platform', 'width=1200,height=800');
            if (testWindow) {
                showResult('success', '✅ 交易平台已在新窗口中打开，请按照测试步骤进行验证。');
            } else {
                showResult('error', '❌ 无法打开新窗口，请手动访问: http://localhost:3000');
            }
        }

        function showTestSteps() {
            const stepsDiv = document.getElementById('test-steps');
            if (stepsDiv.style.display === 'none') {
                stepsDiv.style.display = 'block';
                showResult('info', '📝 测试步骤已显示，请按照步骤进行测试。');
            } else {
                stepsDiv.style.display = 'none';
            }
        }

        function runAutoTest() {
            showResult('info', '🧪 开始自动测试...');
            
            if (!testWindow || testWindow.closed) {
                openTradingPlatform();
                setTimeout(() => {
                    continueAutoTest();
                }, 2000);
            } else {
                continueAutoTest();
            }
        }

        function continueAutoTest() {
            const testSteps = [
                '🔍 检查平台是否正常加载...',
                '🔑 请手动登录 (admin/admin123)',
                '📋 检查左侧菜单结构...',
                '🖱️ 请手动点击各个主菜单项测试子菜单展开',
                '✅ 请验证子菜单项能否正确跳转',
                '🎯 请检查菜单高亮和面包屑导航'
            ];

            let currentStep = 0;
            const interval = setInterval(() => {
                if (currentStep < testSteps.length) {
                    showResult('info', testSteps[currentStep]);
                    currentStep++;
                } else {
                    clearInterval(interval);
                    showResult('success', '🎉 自动测试完成！请手动验证所有功能是否正常工作。');
                }
            }, 2000);
        }

        function showResult(type, message) {
            const resultDiv = document.getElementById('test-result');
            const colors = {
                success: '#d4edda',
                error: '#f8d7da',
                info: '#d1ecf1',
                warning: '#fff3cd'
            };
            const textColors = {
                success: '#155724',
                error: '#721c24',
                info: '#0c5460',
                warning: '#856404'
            };
            
            resultDiv.innerHTML = `
                <div style="
                    background: ${colors[type]};
                    color: ${textColors[type]};
                    padding: 16px;
                    border-radius: 8px;
                    border: 1px solid ${colors[type]};
                    margin-top: 16px;
                ">
                    ${message}
                </div>
            `;
        }

        // 页面加载时显示欢迎信息
        window.onload = function() {
            showResult('info', '🚀 子菜单功能测试页面已加载。点击"打开交易平台"开始测试。');
        };
    </script>
</body>
</html>