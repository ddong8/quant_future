<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仪表板修复验证</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success {
            color: #67C23A;
            font-weight: bold;
        }
        .error {
            color: #F56C6C;
            font-weight: bold;
        }
        .info {
            color: #909399;
        }
        .test-result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .test-result.success {
            background: #f0f9ff;
            border-color: #67C23A;
        }
        .test-result.error {
            background: #fef2f2;
            border-color: #F56C6C;
        }
        button {
            background: #409EFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #337ecc;
        }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 仪表板修复验证</h1>
        <p class="info">验证仪表板加载问题是否已修复</p>

        <div class="highlight">
            <h3>🔧 修复内容</h3>
            <ul>
                <li>✅ 创建了简化版仪表板组件 (SimpleDashboardView.vue)</li>
                <li>✅ 移除了对复杂图表组件的依赖</li>
                <li>✅ 移除了对WebSocket的依赖</li>
                <li>✅ 修复了API路径和类型定义问题</li>
                <li>✅ 更新了路由配置使用简化版本</li>
            </ul>
        </div>

        <div class="test-result" id="test-result">
            <h3>🧪 测试结果</h3>
            <p>点击下面的按钮开始测试...</p>
        </div>

        <div style="text-align: center;">
            <button onclick="runFullTest()">🚀 运行完整测试</button>
            <button onclick="openFrontend()">🌐 打开前端页面</button>
            <button onclick="showInstructions()">📋 查看测试说明</button>
        </div>

        <div id="instructions" style="display: none; margin-top: 20px;">
            <h3>📋 手动测试说明</h3>
            <ol>
                <li><strong>打开前端页面</strong>：点击"打开前端页面"按钮</li>
                <li><strong>登录系统</strong>：使用以下账户登录
                    <ul>
                        <li>管理员：admin / admin123</li>
                        <li>交易员：trader1 / trader123</li>
                        <li>观察者：viewer1 / viewer123</li>
                    </ul>
                </li>
                <li><strong>验证仪表板</strong>：
                    <ul>
                        <li>登录后应该自动跳转到仪表板页面</li>
                        <li>不应该再显示"页面出现错误"的提示</li>
                        <li>应该能看到统计卡片和用户信息</li>
                        <li>数据应该正常加载和显示</li>
                    </ul>
                </li>
                <li><strong>检查控制台</strong>：按F12打开开发者工具，确认没有JavaScript错误</li>
            </ol>
        </div>
    </div>

    <script>
        async function runFullTest() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<h3>🧪 测试进行中...</h3><p>正在执行自动化测试...</p>';
            
            const tests = [];
            
            try {
                // 测试1: 检查后端API
                console.log('测试1: 检查后端API...');
                const healthResponse = await fetch('http://localhost:8000/api/v1/health/');
                if (healthResponse.ok) {
                    tests.push({ name: '后端API健康检查', status: 'success', message: '后端服务正常' });
                } else {
                    tests.push({ name: '后端API健康检查', status: 'error', message: '后端服务异常' });
                }
            } catch (error) {
                tests.push({ name: '后端API健康检查', status: 'error', message: '无法连接后端服务' });
            }

            try {
                // 测试2: 检查前端页面
                console.log('测试2: 检查前端页面...');
                const frontendResponse = await fetch('http://localhost:3000/');
                if (frontendResponse.ok) {
                    tests.push({ name: '前端页面访问', status: 'success', message: '前端页面正常' });
                } else {
                    tests.push({ name: '前端页面访问', status: 'error', message: '前端页面异常' });
                }
            } catch (error) {
                tests.push({ name: '前端页面访问', status: 'error', message: '无法访问前端页面' });
            }

            try {
                // 测试3: 测试登录API
                console.log('测试3: 测试登录API...');
                const loginResponse = await fetch('http://localhost:3000/api/v1/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin123' })
                });
                
                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    if (loginData.success && loginData.data && loginData.data.access_token) {
                        tests.push({ name: '登录API测试', status: 'success', message: '登录功能正常' });
                        
                        // 测试4: 测试仪表板API
                        console.log('测试4: 测试仪表板API...');
                        const token = loginData.data.access_token;
                        
                        const dashboardResponse = await fetch('http://localhost:3000/api/v1/dashboard/summary', {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        if (dashboardResponse.ok) {
                            const dashboardData = await dashboardResponse.json();
                            if (dashboardData.success) {
                                tests.push({ name: '仪表板API测试', status: 'success', message: '仪表板API正常' });
                            } else {
                                tests.push({ name: '仪表板API测试', status: 'error', message: '仪表板API响应异常' });
                            }
                        } else {
                            tests.push({ name: '仪表板API测试', status: 'error', message: '仪表板API请求失败' });
                        }
                    } else {
                        tests.push({ name: '登录API测试', status: 'error', message: '登录响应格式错误' });
                    }
                } else {
                    tests.push({ name: '登录API测试', status: 'error', message: '登录请求失败' });
                }
            } catch (error) {
                tests.push({ name: '登录API测试', status: 'error', message: '登录测试异常: ' + error.message });
            }

            // 显示测试结果
            let html = '<h3>🧪 自动化测试结果</h3>';
            let allPassed = true;
            
            tests.forEach(test => {
                const icon = test.status === 'success' ? '✅' : '❌';
                const className = test.status === 'success' ? 'success' : 'error';
                html += `<p><span class="${className}">${icon} ${test.name}: ${test.message}</span></p>`;
                if (test.status === 'error') allPassed = false;
            });

            if (allPassed) {
                html += `
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <h4 class="success">🎉 所有自动化测试通过！</h4>
                        <p>系统基础功能正常，现在请进行手动测试：</p>
                        <ol>
                            <li>点击"打开前端页面"按钮</li>
                            <li>使用 admin/admin123 登录</li>
                            <li>验证仪表板是否正常显示</li>
                        </ol>
                    </div>
                `;
            } else {
                html += `
                    <div style="background: #fef2f2; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <h4 class="error">⚠️ 部分测试失败</h4>
                        <p>请检查失败的项目并修复后重试</p>
                    </div>
                `;
            }

            resultDiv.innerHTML = html;
            resultDiv.className = `test-result ${allPassed ? 'success' : 'error'}`;
        }

        function openFrontend() {
            const frontendWindow = window.open('http://localhost:3000', '_blank');
            
            if (frontendWindow) {
                const resultDiv = document.getElementById('test-result');
                resultDiv.innerHTML = `
                    <h3>🌐 前端页面已打开</h3>
                    <div class="success">
                        <p>✅ 前端页面已在新窗口中打开</p>
                        <p><strong>请按照以下步骤进行测试：</strong></p>
                        <ol>
                            <li>在新窗口中使用 <code>admin</code> / <code>admin123</code> 登录</li>
                            <li>检查是否成功跳转到仪表板页面</li>
                            <li>确认不再显示"页面出现错误"</li>
                            <li>验证统计数据和用户信息是否正常显示</li>
                            <li>按F12检查控制台是否有错误</li>
                        </ol>
                        <p><strong>如果一切正常，说明仪表板问题已修复！</strong></p>
                    </div>
                `;
                resultDiv.className = 'test-result success';
            } else {
                const resultDiv = document.getElementById('test-result');
                resultDiv.innerHTML = `
                    <h3>❌ 无法打开前端页面</h3>
                    <p class="error">请手动访问: <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></p>
                `;
                resultDiv.className = 'test-result error';
            }
        }

        function showInstructions() {
            const instructionsDiv = document.getElementById('instructions');
            if (instructionsDiv.style.display === 'none') {
                instructionsDiv.style.display = 'block';
            } else {
                instructionsDiv.style.display = 'none';
            }
        }

        // 页面加载时显示欢迎信息
        window.onload = function() {
            console.log('🎯 仪表板修复验证页面已加载');
        };
    </script>
</body>
</html>