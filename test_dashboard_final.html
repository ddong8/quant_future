<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»ªè¡¨æ¿ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success {
            color: #67C23A;
            font-weight: bold;
        }
        .error {
            color: #F56C6C;
            font-weight: bold;
        }
        .info {
            color: #909399;
        }
        .test-result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .test-result.success {
            background: #f0f9ff;
            border-color: #67C23A;
        }
        .test-result.error {
            background: #fef2f2;
            border-color: #F56C6C;
        }
        button {
            background: #409EFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #337ecc;
        }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ä»ªè¡¨æ¿ä¿®å¤éªŒè¯</h1>
        <p class="info">éªŒè¯ä»ªè¡¨æ¿åŠ è½½é—®é¢˜æ˜¯å¦å·²ä¿®å¤</p>

        <div class="highlight">
            <h3>ğŸ”§ ä¿®å¤å†…å®¹</h3>
            <ul>
                <li>âœ… åˆ›å»ºäº†ç®€åŒ–ç‰ˆä»ªè¡¨æ¿ç»„ä»¶ (SimpleDashboardView.vue)</li>
                <li>âœ… ç§»é™¤äº†å¯¹å¤æ‚å›¾è¡¨ç»„ä»¶çš„ä¾èµ–</li>
                <li>âœ… ç§»é™¤äº†å¯¹WebSocketçš„ä¾èµ–</li>
                <li>âœ… ä¿®å¤äº†APIè·¯å¾„å’Œç±»å‹å®šä¹‰é—®é¢˜</li>
                <li>âœ… æ›´æ–°äº†è·¯ç”±é…ç½®ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬</li>
            </ul>
        </div>

        <div class="test-result" id="test-result">
            <h3>ğŸ§ª æµ‹è¯•ç»“æœ</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
        </div>

        <div style="text-align: center;">
            <button onclick="runFullTest()">ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <button onclick="openFrontend()">ğŸŒ æ‰“å¼€å‰ç«¯é¡µé¢</button>
            <button onclick="showInstructions()">ğŸ“‹ æŸ¥çœ‹æµ‹è¯•è¯´æ˜</button>
        </div>

        <div id="instructions" style="display: none; margin-top: 20px;">
            <h3>ğŸ“‹ æ‰‹åŠ¨æµ‹è¯•è¯´æ˜</h3>
            <ol>
                <li><strong>æ‰“å¼€å‰ç«¯é¡µé¢</strong>ï¼šç‚¹å‡»"æ‰“å¼€å‰ç«¯é¡µé¢"æŒ‰é’®</li>
                <li><strong>ç™»å½•ç³»ç»Ÿ</strong>ï¼šä½¿ç”¨ä»¥ä¸‹è´¦æˆ·ç™»å½•
                    <ul>
                        <li>ç®¡ç†å‘˜ï¼šadmin / admin123</li>
                        <li>äº¤æ˜“å‘˜ï¼štrader1 / trader123</li>
                        <li>è§‚å¯Ÿè€…ï¼šviewer1 / viewer123</li>
                    </ul>
                </li>
                <li><strong>éªŒè¯ä»ªè¡¨æ¿</strong>ï¼š
                    <ul>
                        <li>ç™»å½•ååº”è¯¥è‡ªåŠ¨è·³è½¬åˆ°ä»ªè¡¨æ¿é¡µé¢</li>
                        <li>ä¸åº”è¯¥å†æ˜¾ç¤º"é¡µé¢å‡ºç°é”™è¯¯"çš„æç¤º</li>
                        <li>åº”è¯¥èƒ½çœ‹åˆ°ç»Ÿè®¡å¡ç‰‡å’Œç”¨æˆ·ä¿¡æ¯</li>
                        <li>æ•°æ®åº”è¯¥æ­£å¸¸åŠ è½½å’Œæ˜¾ç¤º</li>
                    </ul>
                </li>
                <li><strong>æ£€æŸ¥æ§åˆ¶å°</strong>ï¼šæŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç¡®è®¤æ²¡æœ‰JavaScripté”™è¯¯</li>
            </ol>
        </div>
    </div>

    <script>
        async function runFullTest() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<h3>ğŸ§ª æµ‹è¯•è¿›è¡Œä¸­...</h3><p>æ­£åœ¨æ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•...</p>';
            
            const tests = [];
            
            try {
                // æµ‹è¯•1: æ£€æŸ¥åç«¯API
                console.log('æµ‹è¯•1: æ£€æŸ¥åç«¯API...');
                const healthResponse = await fetch('http://localhost:8000/api/v1/health/');
                if (healthResponse.ok) {
                    tests.push({ name: 'åç«¯APIå¥åº·æ£€æŸ¥', status: 'success', message: 'åç«¯æœåŠ¡æ­£å¸¸' });
                } else {
                    tests.push({ name: 'åç«¯APIå¥åº·æ£€æŸ¥', status: 'error', message: 'åç«¯æœåŠ¡å¼‚å¸¸' });
                }
            } catch (error) {
                tests.push({ name: 'åç«¯APIå¥åº·æ£€æŸ¥', status: 'error', message: 'æ— æ³•è¿æ¥åç«¯æœåŠ¡' });
            }

            try {
                // æµ‹è¯•2: æ£€æŸ¥å‰ç«¯é¡µé¢
                console.log('æµ‹è¯•2: æ£€æŸ¥å‰ç«¯é¡µé¢...');
                const frontendResponse = await fetch('http://localhost:3000/');
                if (frontendResponse.ok) {
                    tests.push({ name: 'å‰ç«¯é¡µé¢è®¿é—®', status: 'success', message: 'å‰ç«¯é¡µé¢æ­£å¸¸' });
                } else {
                    tests.push({ name: 'å‰ç«¯é¡µé¢è®¿é—®', status: 'error', message: 'å‰ç«¯é¡µé¢å¼‚å¸¸' });
                }
            } catch (error) {
                tests.push({ name: 'å‰ç«¯é¡µé¢è®¿é—®', status: 'error', message: 'æ— æ³•è®¿é—®å‰ç«¯é¡µé¢' });
            }

            try {
                // æµ‹è¯•3: æµ‹è¯•ç™»å½•API
                console.log('æµ‹è¯•3: æµ‹è¯•ç™»å½•API...');
                const loginResponse = await fetch('http://localhost:3000/api/v1/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin123' })
                });
                
                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    if (loginData.success && loginData.data && loginData.data.access_token) {
                        tests.push({ name: 'ç™»å½•APIæµ‹è¯•', status: 'success', message: 'ç™»å½•åŠŸèƒ½æ­£å¸¸' });
                        
                        // æµ‹è¯•4: æµ‹è¯•ä»ªè¡¨æ¿API
                        console.log('æµ‹è¯•4: æµ‹è¯•ä»ªè¡¨æ¿API...');
                        const token = loginData.data.access_token;
                        
                        const dashboardResponse = await fetch('http://localhost:3000/api/v1/dashboard/summary', {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        
                        if (dashboardResponse.ok) {
                            const dashboardData = await dashboardResponse.json();
                            if (dashboardData.success) {
                                tests.push({ name: 'ä»ªè¡¨æ¿APIæµ‹è¯•', status: 'success', message: 'ä»ªè¡¨æ¿APIæ­£å¸¸' });
                            } else {
                                tests.push({ name: 'ä»ªè¡¨æ¿APIæµ‹è¯•', status: 'error', message: 'ä»ªè¡¨æ¿APIå“åº”å¼‚å¸¸' });
                            }
                        } else {
                            tests.push({ name: 'ä»ªè¡¨æ¿APIæµ‹è¯•', status: 'error', message: 'ä»ªè¡¨æ¿APIè¯·æ±‚å¤±è´¥' });
                        }
                    } else {
                        tests.push({ name: 'ç™»å½•APIæµ‹è¯•', status: 'error', message: 'ç™»å½•å“åº”æ ¼å¼é”™è¯¯' });
                    }
                } else {
                    tests.push({ name: 'ç™»å½•APIæµ‹è¯•', status: 'error', message: 'ç™»å½•è¯·æ±‚å¤±è´¥' });
                }
            } catch (error) {
                tests.push({ name: 'ç™»å½•APIæµ‹è¯•', status: 'error', message: 'ç™»å½•æµ‹è¯•å¼‚å¸¸: ' + error.message });
            }

            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            let html = '<h3>ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•ç»“æœ</h3>';
            let allPassed = true;
            
            tests.forEach(test => {
                const icon = test.status === 'success' ? 'âœ…' : 'âŒ';
                const className = test.status === 'success' ? 'success' : 'error';
                html += `<p><span class="${className}">${icon} ${test.name}: ${test.message}</span></p>`;
                if (test.status === 'error') allPassed = false;
            });

            if (allPassed) {
                html += `
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <h4 class="success">ğŸ‰ æ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡ï¼</h4>
                        <p>ç³»ç»ŸåŸºç¡€åŠŸèƒ½æ­£å¸¸ï¼Œç°åœ¨è¯·è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•ï¼š</p>
                        <ol>
                            <li>ç‚¹å‡»"æ‰“å¼€å‰ç«¯é¡µé¢"æŒ‰é’®</li>
                            <li>ä½¿ç”¨ admin/admin123 ç™»å½•</li>
                            <li>éªŒè¯ä»ªè¡¨æ¿æ˜¯å¦æ­£å¸¸æ˜¾ç¤º</li>
                        </ol>
                    </div>
                `;
            } else {
                html += `
                    <div style="background: #fef2f2; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <h4 class="error">âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥</h4>
                        <p>è¯·æ£€æŸ¥å¤±è´¥çš„é¡¹ç›®å¹¶ä¿®å¤åé‡è¯•</p>
                    </div>
                `;
            }

            resultDiv.innerHTML = html;
            resultDiv.className = `test-result ${allPassed ? 'success' : 'error'}`;
        }

        function openFrontend() {
            const frontendWindow = window.open('http://localhost:3000', '_blank');
            
            if (frontendWindow) {
                const resultDiv = document.getElementById('test-result');
                resultDiv.innerHTML = `
                    <h3>ğŸŒ å‰ç«¯é¡µé¢å·²æ‰“å¼€</h3>
                    <div class="success">
                        <p>âœ… å‰ç«¯é¡µé¢å·²åœ¨æ–°çª—å£ä¸­æ‰“å¼€</p>
                        <p><strong>è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæµ‹è¯•ï¼š</strong></p>
                        <ol>
                            <li>åœ¨æ–°çª—å£ä¸­ä½¿ç”¨ <code>admin</code> / <code>admin123</code> ç™»å½•</li>
                            <li>æ£€æŸ¥æ˜¯å¦æˆåŠŸè·³è½¬åˆ°ä»ªè¡¨æ¿é¡µé¢</li>
                            <li>ç¡®è®¤ä¸å†æ˜¾ç¤º"é¡µé¢å‡ºç°é”™è¯¯"</li>
                            <li>éªŒè¯ç»Ÿè®¡æ•°æ®å’Œç”¨æˆ·ä¿¡æ¯æ˜¯å¦æ­£å¸¸æ˜¾ç¤º</li>
                            <li>æŒ‰F12æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯</li>
                        </ol>
                        <p><strong>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¯´æ˜ä»ªè¡¨æ¿é—®é¢˜å·²ä¿®å¤ï¼</strong></p>
                    </div>
                `;
                resultDiv.className = 'test-result success';
            } else {
                const resultDiv = document.getElementById('test-result');
                resultDiv.innerHTML = `
                    <h3>âŒ æ— æ³•æ‰“å¼€å‰ç«¯é¡µé¢</h3>
                    <p class="error">è¯·æ‰‹åŠ¨è®¿é—®: <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></p>
                `;
                resultDiv.className = 'test-result error';
            }
        }

        function showInstructions() {
            const instructionsDiv = document.getElementById('instructions');
            if (instructionsDiv.style.display === 'none') {
                instructionsDiv.style.display = 'block';
            } else {
                instructionsDiv.style.display = 'none';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        window.onload = function() {
            console.log('ğŸ¯ ä»ªè¡¨æ¿ä¿®å¤éªŒè¯é¡µé¢å·²åŠ è½½');
        };
    </script>
</body>
</html>