# 量化交易平台用户操作手册

## 目录

1. [平台介绍](#平台介绍)
2. [快速开始](#快速开始)
3. [用户认证](#用户认证)
4. [仪表板概览](#仪表板概览)
5. [策略开发](#策略开发)
6. [回测系统](#回测系统)
7. [实盘交易](#实盘交易)
8. [风险管理](#风险管理)
9. [监控与报告](#监控与报告)
10. [常见问题](#常见问题)

## 平台介绍

量化交易平台是一个基于tqsdk、FastAPI和Vue.js构建的专业量化交易系统，为量化交易员提供策略开发、回测、实盘交易和风险管理的完整解决方案。

### 主要功能

- **策略开发**: 提供在线代码编辑器，支持Python策略开发
- **历史回测**: 基于历史数据验证策略性能
- **实盘交易**: 自动化执行交易策略
- **风险管理**: 实时风险监控和控制
- **数据分析**: 丰富的图表和报告功能
- **多用户管理**: 支持不同角色和权限管理

### 系统要求

- **浏览器**: Chrome 80+, Firefox 75+, Safari 13+
- **网络**: 稳定的互联网连接
- **分辨率**: 建议1920x1080或更高

## 快速开始

### 1. 访问平台

在浏览器中输入平台地址：`http://localhost:3000`

### 2. 用户注册

首次使用需要注册账户：

1. 点击"注册"按钮
2. 填写用户名、邮箱和密码
3. 选择用户角色（交易员/观察者）
4. 点击"提交注册"

### 3. 登录系统

使用注册的账户信息登录：

1. 输入用户名和密码
2. 点击"登录"按钮
3. 系统验证成功后进入主界面

## 用户认证

### 登录流程

1. **输入凭据**: 在登录页面输入用户名和密码
2. **身份验证**: 系统验证用户凭据
3. **获取令牌**: 验证成功后获得访问令牌
4. **进入系统**: 自动跳转到主界面

### 权限管理

系统支持三种用户角色：

- **管理员 (Admin)**: 拥有所有权限，可管理用户和系统配置
- **交易员 (Trader)**: 可以开发策略、执行交易、查看报告
- **观察者 (Viewer)**: 只能查看数据和报告，无法执行交易

### 会话管理

- 访问令牌有效期：24小时
- 系统会在令牌过期前自动刷新
- 长时间不活动会自动登出

## 仪表板概览

### 主要组件

#### 1. 导航栏
- 用户信息显示
- 快速功能入口
- 系统通知

#### 2. 侧边栏菜单
- **仪表板**: 系统概览
- **策略管理**: 策略开发和管理
- **回测系统**: 历史数据回测
- **实盘交易**: 交易执行和监控
- **风险管理**: 风险控制设置
- **市场数据**: 实时行情查看
- **报告中心**: 交易报告和分析

#### 3. 主内容区
- 实时数据展示
- 功能操作界面
- 图表和报告

### 实时数据展示

仪表板显示以下实时信息：

- **账户资金**: 总资金、可用资金、持仓保证金
- **持仓概览**: 当前持仓合约和盈亏情况
- **策略状态**: 运行中的策略及其状态
- **市场行情**: 关注合约的实时价格
- **系统状态**: 连接状态和系统健康度

## 策略开发

### 策略编辑器

#### 1. 创建新策略

1. 点击"策略管理" → "新建策略"
2. 填写策略基本信息：
   - 策略名称
   - 策略描述
   - 选择编程语言（Python）
3. 点击"创建"进入编辑器

#### 2. 代码编辑

策略编辑器提供以下功能：

- **语法高亮**: Python代码语法高亮显示
- **自动补全**: 智能代码补全和提示
- **错误检查**: 实时语法错误检测
- **代码格式化**: 自动代码格式化
- **版本管理**: 代码版本历史记录

#### 3. 策略模板

系统提供多种策略模板：

- **均线策略**: 基于移动平均线的交易策略
- **布林带策略**: 基于布林带指标的策略
- **RSI策略**: 基于相对强弱指数的策略
- **自定义策略**: 空白模板，完全自定义

### 策略开发规范

#### 基本结构

```python
from tqsdk import TqApi, TqAuth
from tqsdk.ta import MA

class MyStrategy:
    def __init__(self):
        self.api = TqApi(auth=TqAuth("username", "password"))
        self.symbol = "SHFE.cu2401"
        
    def initialize(self):
        """策略初始化"""
        pass
        
    def on_bar(self, bar):
        """K线数据更新时调用"""
        pass
        
    def on_tick(self, tick):
        """行情数据更新时调用"""
        pass
        
    def run(self):
        """策略主循环"""
        pass
```

#### 必需函数

- `initialize()`: 策略初始化，设置参数和指标
- `on_bar()`: K线更新时的处理逻辑
- `on_tick()`: 实时行情更新时的处理逻辑
- `run()`: 策略主运行循环

#### 风险控制

策略中应包含必要的风险控制逻辑：

```python
def check_risk(self, order):
    """风险检查"""
    # 检查持仓限制
    if self.get_position_ratio() > 0.3:
        return False
    
    # 检查单笔订单金额
    if order.volume * order.price > 10000:
        return False
        
    return True
```

### 策略测试

#### 1. 语法验证

在保存策略前，系统会自动进行语法验证：

- 检查Python语法错误
- 验证必需函数是否存在
- 检查导入的模块是否可用
- 安全性检查（禁止危险操作）

#### 2. 单元测试

系统提供策略单元测试功能：

1. 点击"测试"按钮
2. 选择测试数据集
3. 设置测试参数
4. 运行测试并查看结果

#### 3. 沙盒测试

在沙盒环境中测试策略：

- 使用模拟数据
- 不影响实盘账户
- 验证策略逻辑正确性

## 回测系统

### 创建回测任务

#### 1. 基本设置

1. 选择要回测的策略
2. 设置回测参数：
   - 回测合约
   - 开始日期和结束日期
   - 初始资金
   - 手续费率

#### 2. 高级设置

- **滑点设置**: 模拟实际交易中的滑点
- **冲击成本**: 考虑大单对价格的影响
- **数据频率**: 选择分钟级或日级数据
- **基准指数**: 设置业绩比较基准

### 回测结果分析

#### 1. 性能指标

系统计算以下关键指标：

- **总收益率**: 策略总体收益表现
- **年化收益率**: 年化后的收益率
- **夏普比率**: 风险调整后的收益率
- **最大回撤**: 策略的最大亏损幅度
- **胜率**: 盈利交易占总交易的比例
- **盈亏比**: 平均盈利与平均亏损的比值

#### 2. 图表分析

- **收益曲线**: 显示策略净值变化
- **回撤曲线**: 显示回撤变化过程
- **持仓分布**: 各合约持仓比例
- **月度收益**: 按月统计的收益表现

#### 3. 交易记录

详细的交易记录包括：

- 交易时间
- 合约代码
- 买卖方向
- 交易价格和数量
- 盈亏金额
- 手续费

### 回测优化

#### 参数优化

1. 选择要优化的参数
2. 设置参数范围和步长
3. 运行参数扫描
4. 分析优化结果

#### 多策略对比

- 同时回测多个策略
- 对比各策略表现
- 分析策略相关性
- 构建策略组合

## 实盘交易

### 账户管理

#### 1. 账户信息

查看交易账户的详细信息：

- **账户余额**: 总资金和可用资金
- **持仓信息**: 当前持有的合约
- **保证金**: 已用和可用保证金
- **盈亏统计**: 已实现和未实现盈亏

#### 2. 资金流水

查看账户资金变动记录：

- 入金/出金记录
- 交易盈亏
- 手续费支出
- 保证金变动

### 策略部署

#### 1. 部署前检查

在部署策略到实盘前，系统会进行以下检查：

- 策略代码完整性验证
- 风险参数设置检查
- 账户资金充足性验证
- 市场开放时间确认

#### 2. 部署流程

1. 选择要部署的策略
2. 设置运行参数
3. 确认风险控制设置
4. 点击"部署到实盘"
5. 系统开始执行策略

#### 3. 策略监控

实盘运行中的策略监控：

- **运行状态**: 策略当前状态
- **持仓情况**: 策略持有的合约
- **交易记录**: 策略执行的交易
- **盈亏统计**: 策略盈亏表现
- **日志信息**: 策略运行日志

### 手动交易

#### 1. 下单操作

手动下单功能：

1. 选择交易合约
2. 设置交易方向（买入/卖出）
3. 选择开平仓类型
4. 输入交易数量和价格
5. 确认订单信息
6. 提交订单

#### 2. 订单管理

- **活跃订单**: 查看未成交订单
- **历史订单**: 查看历史交易记录
- **撤单操作**: 撤销未成交订单
- **改单功能**: 修改订单价格或数量

#### 3. 快速交易

提供快速交易功能：

- **一键平仓**: 快速平掉所有持仓
- **快速下单**: 预设常用交易参数
- **批量操作**: 批量下单或撤单

## 风险管理

### 风险参数设置

#### 1. 资金风险控制

- **最大日亏损**: 单日最大允许亏损金额
- **最大总亏损**: 总体最大允许亏损
- **保证金使用率**: 最大保证金使用比例
- **单笔订单限额**: 单笔交易最大金额

#### 2. 持仓风险控制

- **单合约持仓限制**: 单个合约最大持仓量
- **总持仓限制**: 所有合约总持仓限制
- **集中度控制**: 避免过度集中持仓
- **相关性控制**: 控制相关合约持仓

#### 3. 策略风险控制

- **策略最大亏损**: 单个策略最大亏损限制
- **策略持仓限制**: 策略最大持仓量
- **策略运行时间**: 限制策略运行时间段

### 风险监控

#### 1. 实时监控

系统实时监控以下风险指标：

- 账户资金使用情况
- 持仓集中度
- 未实现盈亏
- 保证金充足率

#### 2. 风险预警

当风险指标接近限制时，系统会：

- 发送邮件通知
- 在界面显示警告
- 记录风险事件日志
- 可选择自动处理

#### 3. 强制平仓

当触发风险限制时，系统会：

- 立即停止相关策略
- 强制平掉超限持仓
- 发送紧急通知
- 记录处理过程

### 异常处理

#### 1. 连接异常

- 自动重连机制
- 连接状态监控
- 异常情况通知

#### 2. 数据异常

- 数据完整性检查
- 异常数据过滤
- 数据修复机制

#### 3. 交易异常

- 订单状态跟踪
- 异常订单处理
- 交易确认机制

## 监控与报告

### 系统监控

#### 1. 性能监控

- **CPU使用率**: 系统CPU占用情况
- **内存使用**: 内存占用和可用情况
- **网络状态**: 网络连接质量
- **数据库性能**: 数据库响应时间

#### 2. 服务监控

- **API响应时间**: 接口响应速度
- **WebSocket连接**: 实时连接状态
- **数据更新频率**: 数据推送频率
- **错误率统计**: 系统错误发生率

### 交易报告

#### 1. 日报

每日交易报告包含：

- 当日交易汇总
- 盈亏统计
- 持仓变化
- 风险指标

#### 2. 周报/月报

定期报告包含：

- 期间交易统计
- 策略表现分析
- 风险事件回顾
- 改进建议

#### 3. 自定义报告

用户可以自定义报告：

- 选择报告时间范围
- 选择包含的指标
- 设置报告格式
- 定时生成和发送

### 数据导出

#### 1. 交易数据导出

- 订单记录导出
- 持仓历史导出
- 盈亏明细导出
- 资金流水导出

#### 2. 策略数据导出

- 策略代码导出
- 回测结果导出
- 策略日志导出

#### 3. 支持格式

- Excel (.xlsx)
- CSV (.csv)
- PDF报告
- JSON数据

## 常见问题

### 登录问题

**Q: 忘记密码怎么办？**
A: 点击登录页面的"忘记密码"链接，输入注册邮箱，系统会发送重置密码的邮件。

**Q: 登录后页面空白？**
A: 请检查浏览器版本是否支持，清除浏览器缓存后重试。

### 策略开发问题

**Q: 策略代码保存失败？**
A: 请检查代码语法是否正确，确保包含必需的函数。

**Q: 如何调试策略？**
A: 使用沙盒测试功能，查看策略运行日志定位问题。

### 交易问题

**Q: 为什么订单没有成交？**
A: 检查订单价格是否合理，市场是否开放，账户资金是否充足。

**Q: 如何撤销订单？**
A: 在订单管理页面找到对应订单，点击"撤单"按钮。

### 数据问题

**Q: 行情数据延迟？**
A: 检查网络连接，确认数据源连接正常。

**Q: 历史数据不完整？**
A: 联系技术支持，确认数据源状态。

### 技术支持

如需更多帮助，请联系：

- **技术支持邮箱**: support@trading-platform.com
- **用户手册**: https://docs.trading-platform.com
- **在线客服**: 工作日 9:00-18:00
- **紧急联系**: 400-123-4567

---

*本手册会根据系统更新持续完善，请关注最新版本。*